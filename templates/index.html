<!DOCTYPE html>
<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="static/d3.layout.cloud.js"></script>
<script src="https://rawgit.com/tpreusse/radar-chart-d3/master/src/radar-chart.js"></script>

<head>
    <title>Word Cloud Example</title>
</head>
<style>
    body {
        font-family:"Lucida Grande","Droid Sans",Arial,Helvetica,sans-serif;
    }
    .bld {
        font-weight: bold;
    }

    .radar-chart .area {
      fill-opacity: 0.7;
    }
    .radar-chart.focus .area {
      fill-opacity: 0.3;
    }
    .radar-chart.focus .area.focused {
      fill-opacity: 0.9;
    }
    .area.germany, .germany .circle {
      fill: #FFD700;
      stroke: none;
    }
    .area.argentina, .argentina .circle {
      fill: #ADD8E6;
      stroke: none;
    }

</style>
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
<link rel="stylesheet" href="https://rawgit.com/tpreusse/radar-chart-d3/master/src/radar-chart.css">
<body>
    <div>
        <input type="text" id="query"/>
        <button id="search">search</button>
        <div id = "cloud"></div>
        <div id = "radar"></div>
    </div>
</body>
<script>

RadarChart.defaultConfig.color = function() {};
RadarChart.defaultConfig.radius = 3;
RadarChart.defaultConfig.w = 400;
RadarChart.defaultConfig.h = 400;


    var frequency_list = [];
    var color = d3.scale.category20();

    function draw(words) {
        d3.select("#cloud").append("svg")
                .attr("width", 1000)
                .attr("height", 800)
                .attr("class", "wordcloud")
                .append("g")
                // without the transform, words words would get cutoff to the left and top, they would
                // appear outside of the SVG area
                .attr("transform", "translate(500,400)")
                .selectAll("text")
                .data(words)
                .enter().append("text")
                .style("font-size", function(d) { return d.size + "px"; })
                .style("fill", function(d, i) { return color(i); })
                //.style("padding",15)
                .style('font-family','Impact')
                .attr("text-anchor", "middle")
                .attr("transform", function(d) {
                    return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                })
                .text(function(d) { return d.text; });
    }


    $('#search').on('click',function(){

        d3.selectAll("svg").remove();


        var regex= /(?:dp\/)[A-Z0-9]+(?:\/)/gi;
        var searchString = $('#query').val();
        console.log(searchString)
        var product_id = searchString.match(regex)[0];
        var len = product_id.length;
        product_id = product_id.substring(3,len-1);


        $.ajax({
            url: "http://localhost:5000/product/"+product_id,
            dataType: "json"
        })
        .done(function(res) {



            frequency_list = res['frequency'];

            //parsing content here
            d3.layout.cloud().size([1000, 800])
                .words(frequency_list)
                .rotate(0)
                .padding(5)
                //.attr("text-anchor", "middle")
                .rotate(function() { return ((Math.random() * 6) - 3) * 20; })
                //.rotate(function() { return -90+(Math.random() * 2) * 180; })
                .fontSize(function(d) { return d.size; })
                .on("end", draw)
                .start();


          // add radars
          var temp = res['sentiment'].entities["0"].emotion;
          var keys = Object.keys(temp);
          //console.log(keys);
          var arr = [];
          for(var i=0;i<keys.length;i++){
            var keyx = keys[i];
            var obj = [];
            obj[keyx] = temp[keyx];
            if(keys!="n"){
            arr.push(obj);
          }
            //console.log(obj);
          }
          //var arr = $.map(temp, function(el) { return el });
          //var ar = $.map(arr[1], function(el) { return el });
          function randomDataset() {
            var x = {
              className:"class",
              axes:arr.map(function(x) {
                  //console.log(a+"a");
                  var key = Object.keys(x)[0];
                  var valuex = x[key];
                  //console.log(key+valuex);
                  return {axis: key, value:valuex};
            })
          };
          var result = [];
          result.push(x);
          return result;
          }
          console.log(randomDataset());
            var chart = RadarChart.chart();
            var cfg = chart.config(); // retrieve default config
            var svg = d3.select('#radar').append('svg')
              .attr('width', cfg.w + cfg.w + 50)
              .attr('height', cfg.h + cfg.h / 4);
            svg.append('g').classed('single', 1).datum(randomDataset()).call(chart);


        })
        .fail(function() {
          alert( "error" );
        })



    })


</script>



</html>
